version: '3.8'

# SaveXTube Docker Compose 配置示例
# 使用镜像: kyfour/savetube

services:
  savextube:
    # 使用您在 DockerHub 上的镜像
    image: kyfour/savetube:latest
    container_name: savextube
    restart: unless-stopped
    
    environment:
      # 时区设置
      TZ: Asia/Shanghai
    
    ports:
      # Web 界面和 API 端口
      - "8530:8530"
    
    volumes:
      # 下载文件保存目录（必需）
      - ./downloads:/downloads/
      
      # Cookies 文件目录（可选，用于访问需要登录的内容）
      - ./cookies:/app/cookies
      
      # 配置文件目录（可选，用于 savextube.toml）
      - ./config:/app/config/
      
      # 数据库目录（可选，保存订阅等数据）
      - ./db:/app/db/
      
      # 日志目录（可选）
      - ./logs:/app/logs/
      
      # Docker socket（可选，用于容器重启功能）
      # 如需使用 /reboot 命令，请取消下面的注释
      # - /var/run/docker.sock:/var/run/docker.sock
    
    # 健康检查
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8530/"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    
    # 资源限制（可选，根据服务器配置调整）
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2'
    #       memory: 2G
    #     reservations:
    #       cpus: '1'
    #       memory: 1G

# 如果需要同时部署 Wrapper（用于 Apple Music 高音质下载）
# 请取消下面的注释
#
#   wrapper:
#     image: savextube/wrapper:latest
#     container_name: wrapper
#     restart: unless-stopped
#     environment:
#       ARGS: "-M 20020 -H 0.0.0.0"
#     ports:
#       - "10020:10020"
#       - "20020:20020"
#     volumes:
#       - ./wrapper/rootfs/data:/app/rootfs/data
#     healthcheck:
#       test: ["CMD", "curl", "-f", "http://localhost:10020/"]
#       interval: 30s
#       timeout: 10s
#       retries: 3

# 如果需要 qBittorrent（用于磁力链接下载）
# 请取消下面的注释
#
#   qbittorrent:
#     image: linuxserver/qbittorrent:latest
#     container_name: qbittorrent
#     restart: unless-stopped
#     environment:
#       - PUID=1000
#       - PGID=1000
#       - TZ=Asia/Shanghai
#       - WEBUI_PORT=8088
#     ports:
#       - "8088:8088"
#       - "6881:6881"
#       - "6881:6881/udp"
#     volumes:
#       - ./qbittorrent/config:/config
#       - ./downloads:/downloads
